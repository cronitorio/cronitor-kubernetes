name: Run Kubernetes end-to-end tests
on:
  pull_request: {}
  push:
    branches:
      - k8s-tests

jobs:

  integration-tests:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2.3.4

      - name: Set up Helm
        uses: azure/setup-helm@v1
        with:
          version: v3.7.2

      - uses: actions/setup-python@v2
        with:
          python-version: 3.7

# See: https://github.com/helm/chart-testing-action
#      - name: Set up chart-testing
#        uses: helm/chart-testing-action@v2.2.0

      - name: Create Kind cluster
        uses: helm/kind-action@v1.2.0
        with:
          version: v0.11.1
          node_image: kindest/node:v1.20.7


#      - uses: engineerd/setup-kind@v0.5.0
#        with:
#          wait: 300s
#          version: v0.11.1
#          image: kindest/node:v1.20.7

      - name: Apply test YAML
        run: |
          kubectl apply -f test-yaml/